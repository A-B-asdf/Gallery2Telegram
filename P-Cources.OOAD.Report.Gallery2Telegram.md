# 2. **Предметная область проекта**

Современные пользователи делают много фото и видео на телефоне, и часто используют Telegram как средство хранение медиа. Это решает задачи освобождения памяти на телефоне и обмена медиа между устройствами. Telegram позволяет создавать каналы, папки каналов, передавать файлы и работать с чатами, что делает его потенциально удобной платформой для организации фотографий, а также, что самое важное, на данный момент не имеет ограничений на хранение файлов.

## 2.1 **Существующие проблемы**

Нет автоматических решений, которые берут галерею телефона и сами загружают медиа в Телеграм без ручного вмешательства.

## 2.2 **Предполагаемое решение**

Разработать мобильное приложение, которое автоматизирует выгрузку медиа из галереи телефона в систему Telegram каналов. Медиа должны быть удобно упорядочены, например, по датам / папкам, конкретный способ может быть выбран в ходе анализа пользовательских предпочтений.

# 3. **Требования к программному решению**

Данный раздел описывает требования к программной системе, разрабатываемой в рамках проекта *Автоматическая выгрузка галереи телефона в Telegram.*

## 3.1 **Роли**

Роль - это что-то (например: другая система) или кто-то (например: человек) вне системы, которые взаимодействуют с ней. В предлагаемой к разработке системе идентифицированы следующие роли:

- Неавторизованный Пользователь – человек, который впервые запустил приложение и еще не прошел аутентификацию в Telegram. Может выполнить только одно действие — авторизоваться.
- Авторизованный Пользователь – человек, успешно прошедший аутентификацию. Может настраивать приложение, управлять синхронизацией и просматривать ее статус.

## 3.2 **Функциональные требования для роли Неавторизованный Пользователь**

### 3.2.1 **Первоначальная настройка и авторизация**

**Описание:** Неавторизованный Пользователь должен иметь возможность пройти аутентификацию через Telegram, чтобы получить права на управление каналами и загрузку медиа от своего имени.

**Основной поток событий:**

1. Пользователь запускает приложение.
2. Система отображает приветственный экран с кнопкой "Авторизоваться через телеграм".
3. Пользователь нажимает кнопку "Авторизоваться через телеграм".
4. Система запрашивает номер телефона Пользователя, связанный с Telegram.
5. Пользователь вводит свой номер телефона.
6. Система отправляет код подтверждения на указанный номер.
7. Пользователь получает код подтверждения и вводит его в приложении.
8. Система подтверждает код и сохраняет учетные данные для последующих операций.
9. Система присваивает Пользователю роль "Авторизованный Пользователь" и перенаправляет его на главный экран приложения.

**Альтернативные потоки событий:**

- **А1: Пользователь отменяет авторизацию**
1. На шагах 4, 6, 7 Основного потока Пользователь нажимает кнопку "Назад" или "Отмена".
2. Система возвращает Пользователя на приветственный экран (шаг 2 Основного потока). Процесс авторизации прерывается.

- **А2: Введен неверный или несуществующий номер телефона**
1. На шаге 5 Основного потока Система определяет, что введенный номер телефона имеет неверный формат или не зарегистрирован в Telegram.
2. Система отображает сообщение об ошибке: "Неверный номер телефона. Пожалуйста, проверьте и попробуйте снова."
3. Система возвращает Пользователя к шагу 4 Основного потока.

- **А3: Введен неверный код подтверждения**
1. На шаге 7 Основного потока Пользователь вводит неверный код подтверждения.
2. Система отображает сообщение об ошибке: "Неверный код. Пожалуйста, попробуйте снова."
3. Система предоставляет Пользователю возможность ввести код повторно (возврат к шагу 6 Основного потока).
4. Если код введен неверно три раза подряд, Система аннулирует отправленный код и возвращает Пользователя к шагу 4 Основного потока для запроса нового кода.

- **А4: Код подтверждения не доставлен**
1. На шаге 7 система отображает обратный отсчет "Отправить код повторно через: X сек.".
2. По истечении таймера кнопка становится активной.
3. Пользователь нажимает активную кнопку "Отправить код повторно".
4. Сценарий возвращается к шагу 6 Основного потока.

### 3.2.2 **Предоставление разрешений**

## 3.3 **Функциональные требования для роли Авторизованный пользователь**

### 3.3.1 **Первоначальная настройка способа организации медиа**

**Описание:** Авторизованный Пользователь должен иметь возможность впервые настроить приложение, выбрав предпочтительный способ организации медиафайлов в Telegram, после чего система автоматически создаст необходимую структуру (каналы, чаты).

**Основной поток событий:**

1. Пользователь нажимает кнопку “Настройка хранения” и попадает на экран первоначальной настройки.
2. Система предлагает Пользователю выбрать один из способов организации медиа.
3. Пользователь выбирает предпочтительный вариант и, при необходимости, задает параметры.
4. Система обеспечивает создание целевой структуры для хранения медиа в Telegram, соответствующей выбранному пользователем способу организации.
5. Система сохраняет выбранную конфигурацию, и приложение переходит в главный экран.

**Альтернативные потоки событий:**

- **А1: Пользователь не завершил настройку**
1. На любом из шагов 2-4 Основного потока Пользователь нажимает "Назад" или "Пропустить".
2. Система отображает предупреждение: "Без настройки хранения автоматическая синхронизация невозможна. Вы сможете настроить это позже в настройках."
3. Система перенаправляет Пользователя на главный экран. Конфигурация не сохраняется.

- **А2: Ошибка создания структуры в Telegram**
1. На шаге 4 Основного потока Система по какой-то причине не может создать каналы и чаты.
2. Система отображает сообщение об ошибке: "Не удалось создать структуру каналов. Пожалуйста, проверьте соединение и попробуйте снова."
3. Система возвращает Пользователя к шагу 2 Основного потока.

### 3.3.2 **Настройка параметров синхронизации**

**Описание:** Авторизованный Пользователь должен иметь возможность гибко настраивать, какие медиафайлы и куда загружать.

**Основной поток событий:**

1. Пользователь переходит в раздел "Настройки синхронизации" из главного меню.
2. Система отображает доступные параметры:
   - **Источники:** все папки, только папка "Camera", только определенные альбомы.
   - **Типы файлов:** фото, видео, все вместе.
   - **Периодичность и условия:** мгновенно при появлении нового файла, ежедневно в заданное время, только при подключении к Wi-Fi.
3. Пользователь задает необходимые параметры.
4. Пользователь подтверждает изменения.
5. Система сохраняет конфигурацию.

**Альтернативные потоки событий:**

- **А1: Пользователь отменяет изменения**
1. На шагах 3 или 4 Основного потока Пользователь нажимает "Отмена" или "Назад".
2. Система отображает диалоговое окно: "Все несохраненные изменения будут потеряны. Вы уверены?"
3. Если Пользователь подтверждает отмену, Система возвращает его на главный экран без сохранения изменений.

### 3.3.3 **Запуск ручной синхронизации**

**Описание:** Авторизованный Пользователь должен иметь возможность в любой момент инициировать процесс синхронизации вручную, не дожидаясь автоматического запуска.

**Основной поток событий:**

1. Пользователь на главном экране нажимает кнопку "Синхронизировать".
2. Система проверяет наличие новых или еще не загруженных медиафайлов в соответствии с текущими настройками синхронизации.
3. Система начинает процесс загрузки найденных файлов в назначенные каналы и чаты в Telegram.
4. Система отображает прогресс операции (например, количество обработанных файлов, общий прогресс-бар).
5. По завершении процесса система отображает итоговый статус.

**Альтернативные потоки событий:**

- **А1: Новые файлы для синхронизации отсутствуют**
1. На шаге 2 Основного потока Система не обнаруживает новых или не загруженных файлов.
2. Система отображает уведомление: "Нет новых файлов для синхронизации".
3. Сценарий завершается.

- **А2: Пользователь прерывает синхронизацию**
1. На шаге 4 Основного потока Пользователь нажимает кнопку "Отменить".
2. Система приостанавливает загрузку текущего файла и отображает диалоговое окно: "Синхронизация будет прервана. Ок?"
3. Если Пользователь подтверждает отмену, Система останавливает процесс и возвращается на главный экран.

*   **А3: Ошибка загрузки файла (сетевые сбои и пр.)**
1. На шаге 3 Основного потока возникает ошибка при загрузке одного из файлов (например, потеря сети, временная ошибка API Telegram).
2. Система приостанавливает загрузку текущего файла и делает до 3 повторных попыток с экспоненциальной задержкой (например, через 2, 4, 8 секунд).
3. **Если попытки успешны:** Система продолжает синхронизацию со следующего файла в порядке очереди.
4. **Если все попытки неудачны:** Система полностью прерывает процесс синхронизации.
5. Система отображает сообщение об ошибке и возвращает Пользователя на главный экран.
