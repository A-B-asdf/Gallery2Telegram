# 2. **Предметная область проекта**

Современные пользователи делают много фото и видео на телефоне, и часто используют Telegram как средство хранение медиа. Это решает задачи освобождения памяти на телефоне и обмена медиа между устройствами. Telegram позволяет создавать каналы, папки каналов, передавать файлы и работать с чатами, что делает его потенциально удобной платформой для организации фотографий, а также, что самое важное, на данный момент не имеет ограничений на хранение файлов.

## 2.1 **Существующие проблемы**

Нет автоматических решений, которые берут галерею телефона и сами загружают медиа в Телеграм без ручного вмешательства.

## 2.2 **Предполагаемое решение**

Разработать мобильное приложение, которое автоматизирует выгрузку медиа из галереи телефона в систему Telegram каналов. Медиа должны быть удобно упорядочены, например, по датам / папкам, конкретный способ может быть выбран в ходе анализа пользовательских предпочтений.

# 3. **Требования к программному решению**

Данный раздел описывает требования к программной системе, разрабатываемой в рамках проекта *Автоматическая выгрузка галереи телефона в Telegram.*

## 3.1 **Роли**

Роль - это что-то (например: другая система) или кто-то (например: человек) вне системы, которые взаимодействуют с ней. В предлагаемой к разработке системе идентифицированы следующие роли:

- Неавторизованный Пользователь – человек, который впервые запустил приложение и еще не прошел аутентификацию в Telegram. Может выполнить только одно действие — авторизоваться.
- Авторизованный Пользователь – человек, успешно прошедший аутентификацию. Может настраивать приложение, управлять синхронизацией и просматривать ее статус.

## 3.2 **Функциональные требования для роли Неавторизованный Пользователь**

### 3.2.1 **Первоначальная настройка и авторизация**

**Описание:** Неавторизованный Пользователь должен иметь возможность пройти аутентификацию через Telegram, чтобы получить права на управление каналами и загрузку медиа от своего имени.

**Основной поток событий:**

1. Пользователь запускает приложение.
2. Система отображает приветственный экран с кнопкой "Авторизоваться через телеграм".
3. Пользователь нажимает кнопку "Авторизоваться через телеграм".
4. Система запрашивает номер телефона Пользователя, связанный с Telegram.
5. Пользователь вводит свой номер телефона.
6. Система отправляет код подтверждения на указанный номер.
7. Пользователь получает код подтверждения и вводит его в приложении.
8. Система подтверждает код и сохраняет учетные данные для последующих операций.
9. Система присваивает Пользователю роль "Авторизованный Пользователь" и перенаправляет его на главный экран приложения.

**Альтернативные потоки событий:**

- **А1: Пользователь отменяет авторизацию**
1. На шагах 4, 6, 7 Основного потока Пользователь нажимает кнопку "Назад" или "Отмена".
2. Система возвращает Пользователя на приветственный экран (шаг 2 Основного потока). Процесс авторизации прерывается.

- **А2: Введен неверный или несуществующий номер телефона**
1. На шаге 5 Основного потока Система определяет, что введенный номер телефона имеет неверный формат или не зарегистрирован в Telegram.
2. Система отображает сообщение об ошибке: "Неверный номер телефона. Пожалуйста, проверьте и попробуйте снова."
3. Система возвращает Пользователя к шагу 4 Основного потока.

- **А3: Введен неверный код подтверждения**
1. На шаге 7 Основного потока Пользователь вводит неверный код подтверждения.
2. Система отображает сообщение об ошибке: "Неверный код. Пожалуйста, попробуйте снова."
3. Система предоставляет Пользователю возможность ввести код повторно (возврат к шагу 6 Основного потока).
4. Если код введен неверно три раза подряд, Система аннулирует отправленный код и возвращает Пользователя к шагу 4 Основного потока для запроса нового кода.

- **А4: Код подтверждения не доставлен**
1. На шаге 7 Основного потока Пользователь не получает код подтверждения в ожидаемое время.
2. Система отображает кнопку "Отправить код повторно через n сек" с обратным отсчетом таймера, 
3. По истечении таймера кнопка становится активной
4. Пользователь нажимает кнопку "Отправить код повторно".
5. Система аннулирует предыдущий код и отправляет новый код подтверждения на номер телефона Пользователя.
6. Сценарий возвращается к шагу 6 Основного потока.

### 3.2.2 **Предоставление разрешений на доступ к галерее**

**Описание:** Авторизованный Пользователь должен предоставить приложению разрешение на чтение медиафайлов из галереи устройства для возможности их синхронизации. Запрос разрешения выполняется при первом запуске после авторизации или при попытке начать синхронизацию, если разрешение еще не предоставлено.

**Основной поток событий:**

1. Система отображает диалоговое окно с объяснением необходимости доступа к галерее и кнопками "Разрешить" и "Отказать".
2. Пользователь нажимает "Разрешить".
3. Система перенаправляет Пользователя в системные настройки для предоставления разрешения.
4. Пользователь в системных настройках предоставляет разрешение.
5. Система фиксирует предоставление разрешения и продолжает операцию, которая требовала доступа (например, переход к настройке синхронизации или запуск синхронизации).

**Альтернативные потоки событий:**

- **А1: Пользователь отказывает в предоставлении разрешения**
1. На шаге 2 Основного потока Пользователь нажимает "Отказать".
2. Система отображает сообщение: "Без разрешения на доступ к галерее синхронизация медиафайлов невозможна. Вы можете предоставить разрешение позже в настройках устройства."
3. Система возвращает Пользователя на предыдущий экран.

- **А2: Пользователь ранее запретил доступ и не предоставляет разрешение**
1. На шаге 4 Основного потока Пользователь в системных настройках не предоставляет разрешение (нажимает "Запретить" или просто выходит из настроек).
2. Система при возврате в приложение определяет, что разрешение не предоставлено.
3. Система отображает сообщение: "Доступ к галерее запрещен. Если вы хотите использовать синхронизацию, предоставьте разрешение в настройках устройства."
4. Система возвращает Пользователя на предыдущий экран.

## 3.3 **Функциональные требования для роли Авторизованный пользователь**

### 3.3.1 **Выбор способа организации медиа**

**Описание:** Авторизованный Пользователь должен иметь возможность впервые настроить приложение, выбрав предпочтительный способ организации медиафайлов в Telegram, после чего система автоматически создаст необходимую структуру (каналы, чаты).

**Основной поток событий:**

1. Пользователь нажимает кнопку “Настройка хранения”.
2. Система предлагает Пользователю выбрать один из способов организации медиа.
3. Пользователь выбирает предпочтительный вариант и, при необходимости, задает параметры.
4. Система обеспечивает создание целевой структуры для хранения медиа в Telegram, соответствующей выбранному пользователем способу организации.
5. Система сохраняет выбранную конфигурацию, и приложение переходит в главный экран.

**Альтернативные потоки событий:**

- **А1: Пользователь не завершил настройку**
1. На любом из шагов 2-4 Основного потока Пользователь нажимает "Назад" или "Пропустить".
2. Система отображает предупреждение: "Без настройки хранения автоматическая синхронизация невозможна. Вы сможете настроить это позже в настройках."
3. Система перенаправляет Пользователя на главный экран. Конфигурация не сохраняется.

- **А2: Ошибка создания структуры в Telegram**
1. На шаге 4 Основного потока Система по какой-то причине не может создать каналы и чаты.
2. Система отображает сообщение об ошибке: "Не удалось создать структуру каналов. Пожалуйста, проверьте соединение и попробуйте снова."
3. Система возвращает Пользователя к шагу 2 Основного потока.

### 3.3.2 **Настройка параметров синхронизации**

**Описание:** Авторизованный Пользователь должен иметь возможность гибко настраивать, какие медиафайлы и куда загружать.

**Основной поток событий:**

1. Пользователь переходит в раздел "Настройки синхронизации" из главного меню.
2. Система отображает доступные параметры:
   - **Источники:** все папки, только папка "Camera", только определенные альбомы.
   - **Типы файлов:** фото, видео, все вместе.
   - **Периодичность и условия:** мгновенно при появлении нового файла, ежедневно в заданное время, только при подключении к Wi-Fi.
3. Пользователь задает необходимые параметры.
4. Пользователь подтверждает изменения.
5. Система сохраняет конфигурацию.

**Альтернативные потоки событий:**

- **А1: Пользователь отменяет изменения**
1. На шагах 3 или 4 Основного потока Пользователь нажимает "Отмена" или "Назад".
2. Система отображает диалоговое окно: "Все несохраненные изменения будут потеряны. Вы уверены?"
3. Если Пользователь подтверждает отмену, Система возвращает его на главный экран без сохранения изменений.

### 3.3.3 **Запуск ручной синхронизации**

**Описание:** Авторизованный Пользователь должен иметь возможность в любой момент инициировать процесс синхронизации вручную, не дожидаясь автоматического запуска.

**Основной поток событий:**

1. Пользователь на главном экране нажимает кнопку "Синхронизировать".
2. Система проверяет наличие новых или еще не загруженных медиафайлов в соответствии с текущими настройками синхронизации.
3. Система начинает процесс загрузки найденных файлов в назначенные каналы и чаты в Telegram.
4. Система отображает прогресс операции (например, количество обработанных файлов, общий прогресс-бар).
5. По завершении процесса система отображает итоговый статус.

**Альтернативные потоки событий:**

- **А1: Новые файлы для синхронизации отсутствуют**
1. На шаге 2 Основного потока Система не обнаруживает новых или не загруженных файлов.
2. Система отображает уведомление: "Нет новых файлов для синхронизации".
3. Сценарий завершается.

- **А2: Пользователь прерывает синхронизацию**
1. На шаге 4 Основного потока Пользователь нажимает кнопку "Отменить".
2. Загрузка приостанавливается
3. Отображается диалоговое окно: "Синхронизация будет прервана. Ок?"
4. Если Пользователь подтверждает отмену, Система останавливает процесс и возвращается на главный экран.

- **А3: Ошибка загрузки файла (сетевые сбои и пр.)**
1. На шаге 3 Основного потока возникает ошибка при загрузке одного из файлов (например, потеря сети, временная ошибка API Telegram).
2. Система приостанавливает загрузку и делает до 3 повторных попыток.
3. **Если попытки успешны:** Система возобновляет загрузку.
4. **Если все попытки неудачны:** Система полностью прерывает процесс синхронизации, отображает сообщение об ошибке и возвращает Пользователя на главный экран.

## 3.4 **Нефункциональные требования**

Данный раздел описывает требования к атрибутам системы, не связанным с ее прямой функциональностью. Эти требования определяют, *как* система должна выполнять свои функции.

### 3.4.1 **Производительность**

- **Скорость загрузки медиа:**
    - Приложение должно обеспечивать среднюю скорость загрузки файлов не менее 1 МБ/с при подключении к Wi-Fi со следующими характеристиками: скорость скачивания ≥ 10 Мбит/с, скорость загрузки ≥ 5 Мбит/с, пинг ≤ 50 мс.
    - Загрузка пакета из 100 фотографий общим размером до 500 МБ на устройстве **Samsung Galaxy M21** должна занимать не более 10 минут при условии соответствия сети указанным выше параметрам.
- **Время отклика UI:**
    - 95% пользовательских интерфейсных операций на устройстве **Samsung Galaxy M21** должны выполняться менее чем за 1 секунду.
    - Время запуска приложения на устройстве **Samsung Galaxy M21** не должно превышать 3 секунд.
- **Эффективность использования ресурсов:**
    - Потребление оперативной памяти приложением в фоновом режиме не должно превышать 150 МБ.
    - При активной синхронизации потребление оперативной памяти не должно превышать 300 МБ.
    - Средняя нагрузка на ЦП при активной синхронизации не должна превышать 30% на устройстве **Samsung Galaxy M21**, с пиковыми кратковременными нагрузками до 70%.

### 3.4.2 **Безопасность**

- **Хранение учетных данных:**
    - Учетные данные сессии Telegram должны храниться в защищенном хранилище операционной системы.
- **Конфиденциальность данных:**
    - Медиафайлы не должны передаваться на какие-либо сторонние серверы, кроме официальных серверов Telegram.
    - Метаданные о медиафайлах не должны сохраняться в логах, доступных для сторонних сервисов аналитики.

### 3.4.3 **Надежность**

- **Устойчивость к сбоям:**
    - Приложение должно корректно обрабатывать потерю сетевого соединения во время синхронизации, возобновляя загрузку с точки останова, а не с начала, после восстановления связи.
    - Приложение не должно завершаться аварийно чаще, чем с частотой 0.1% от всех сессий.
- **Целостность данных:**
    - Система должна гарантировать успешную загрузку файла и его читаемость в клиенте Telegram. Исходный файл на устройстве должен оставаться неизменным.
    - При выборе пользователем опции "Загружать без сжатия" система должна гарантировать, что загруженный файл является битовой копией исходного.

### 3.4.4 **Удобство использования**

- **Процесс настройки:**
    - Процесс первоначальной настройки должен состоять не более чем из 5 последовательных экранов.
- **Доступность:**
    - Интерфейс приложения должен поддерживать масштабирование шрифта, установленное в системных настройках устройства.
    - Все интерактивные элементы должны иметь минимальную область нажатия 44x44 dp (density-independent pixels).
- **Запрос разрешений:**
    - Запрос на доступ к медиа должен появляться, когда это соответствует пользовательскому контексту. Запрос должен содержать понятное объяснение причины.

### 3.4.5 **Совместимость**

- **Поддерживаемые версии ОС:**
    - Для Android: минимальная версия API уровня 26 (Android 8.0 Oreo). Целевая версия - последняя стабильная версия Android.
- **Поддержка форматов файлов:**
    - Приложение должно поддерживать все распространенные форматы медиа, которые могут быть сохранены в галерее стандартной камеры смартфона.

### 3.4.6 **Эксплуатационные требования**

- **Энергопотребление:**
    - На устройстве **Samsung Galaxy M21** с батареей в состоянии не более 20% износа приложение в фоновом режиме (ожидание триггера для автоматической синхронизации) не должно вызывать снижения заряда батареи более чем на 5% за 24 часа в режиме ожидания.
    - Активная синхронизация на устройстве **Samsung Galaxy M21** не должна разряжать батарею со скоростью более 15% в час.
- **Использование сети:**
    - При синхронизации по мобильной сети (если данная опция разрешена пользователем) приложение должно предоставлять пользователю предупреждение о потенциальном превышении лимита трафика при попытке загрузить пакет файлов размером более 100 МБ.

### 3.4.7 **Требования к коду и сопровождению**

- **Модульность:**
    - Кодовая база должна быть разделена на минимум 3 модуля: `app` (UI), `core` (бизнес-логика), `data` (работа с API Telegram и локальной галереей). Уровень циклической сложности (Cyclomatic Complexity) для ключевых компонентов бизнес-логики не должен превышать 10.
- **Тестируемость:**
    - Покрытие модульными тестами (Unit Test Coverage) для модуля `core` (бизнес-логика) должно составлять не менее 80%.
    - Критические пользовательские сценарии (авторизация, настройка, ручная синхронизация) должны быть покрыты UI-тестами (Espresso для Android, XCTest для iOS).
